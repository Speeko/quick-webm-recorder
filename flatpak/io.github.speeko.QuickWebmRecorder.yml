app-id: io.github.speeko.QuickWebmRecorder
runtime: org.gnome.Platform
runtime-version: '47'
sdk: org.gnome.Sdk
command: quick-webm-recorder

finish-args:
  # X11 access for screen capture
  - --share=ipc
  - --socket=x11
  # Audio access
  - --socket=pulseaudio
  # Filesystem access for saving recordings
  - --filesystem=xdg-videos
  - --filesystem=xdg-config/quick-webm-recorder
  # For clipboard
  - --share=network

modules:
  # pynput dependency
  - name: python3-pynput
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pynput" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/63/fe/a17c106a1f4061ce83f04d14bcedcfb2c38c7793ea56bfb906a6fadae8cb/evdev-1.9.2.tar.gz
        sha256: 5d3278892ce1f92a74d6bf888cc8525d9f68af85dbe336c95d1c87fb8f423069
      - type: file
        url: https://files.pythonhosted.org/packages/59/4f/ac3fa906ae8a375a536b12794128c5efacade9eaa917a35dfd27ce0c7400/pynput-1.8.1-py2.py3-none-any.whl
        sha256: 42dfcf27404459ca16ca889c8fb8ffe42a9fe54f722fd1a3e130728e59e768d2
      - type: file
        url: https://files.pythonhosted.org/packages/fc/b8/ff33610932e0ee81ae7f1269c890f697d56ff74b9f5b2ee5d9b7fa2c5355/python_xlib-0.33-py2.py3-none-any.whl
        sha256: c3534038d42e0df2f1392a1b30a15a4ff5fdc2b86cfa94f072bf11b10a164398
      - type: file
        url: https://files.pythonhosted.org/packages/b7/ce/149a00dd41f10bc29e5921b496af8b574d8413afcd5e30dfa0ed46c2cc5e/six-1.17.0-py2.py3-none-any.whl
        sha256: 4721f391ed90541fddacab5acf947aa0d3dc7d27b2e1e8eda2be8970586c3274

  # libXmu (required for xclip)
  - name: libXmu
    buildsystem: autotools
    sources:
      - type: archive
        url: https://www.x.org/releases/individual/lib/libXmu-1.2.1.tar.gz
        sha256: bf0902583dd1123856c11e0a5085bd3c6e9886fbbd44954464975fd7d52eb599

  # xclip for clipboard
  - name: xclip
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/astrand/xclip/archive/refs/tags/0.13.tar.gz
        sha256: ca5b8804e3c910a66423a882d79bf3c9450b875ac8528791fb60ec9de667f758

  # Main application
  - name: quick-webm-recorder
    buildsystem: simple
    build-commands:
      - install -Dm755 src/main.py ${FLATPAK_DEST}/lib/quick-webm-recorder/main.py
      - install -Dm644 src/config.py ${FLATPAK_DEST}/lib/quick-webm-recorder/config.py
      - install -Dm644 src/hotkey.py ${FLATPAK_DEST}/lib/quick-webm-recorder/hotkey.py
      - install -Dm644 src/overlay.py ${FLATPAK_DEST}/lib/quick-webm-recorder/overlay.py
      - install -Dm644 src/recorder.py ${FLATPAK_DEST}/lib/quick-webm-recorder/recorder.py
      - install -Dm755 quick-webm-recorder.sh ${FLATPAK_DEST}/bin/quick-webm-recorder
      - install -Dm644 flatpak/io.github.speeko.QuickWebmRecorder.desktop ${FLATPAK_DEST}/share/applications/io.github.speeko.QuickWebmRecorder.desktop
      - install -Dm644 flatpak/io.github.speeko.QuickWebmRecorder.metainfo.xml ${FLATPAK_DEST}/share/metainfo/io.github.speeko.QuickWebmRecorder.metainfo.xml
      - install -Dm644 flatpak/io.github.speeko.QuickWebmRecorder.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/io.github.speeko.QuickWebmRecorder.svg
      - install -Dm644 LICENSE ${FLATPAK_DEST}/share/licenses/io.github.speeko.QuickWebmRecorder/LICENSE
    sources:
      - type: dir
        path: ..
